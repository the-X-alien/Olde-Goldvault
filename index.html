<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Olde Goldvault</title>
  <link href="https://fonts.googleapis.com/css2?family=MedievalSharp&display=swap" rel="stylesheet">
  <style>
    :root {
      --border: #8b5a2b;
      --paper: #fffaf0;
      --paper-2: #deb887;
      --accent: #a0522d;
      --positive: #006400;
      --negative: #8b0000;
    }
    body {
      margin: 0;
      font-family: 'MedievalSharp', cursive;
      background: linear-gradient(45deg,#f4e4bc 0%,#e8d5a3 50%,#dcc485 100%);
      text-align: center;
    }
    h1 {
      margin: 18px 0;
      font-size: 2.6rem;
    }
    .container {
      max-width: 940px;
      margin: 36px auto;
      padding: 28px;
      background: rgba(245,222,179,0.95);
      border: 6px solid var(--border);
      border-radius: 16px;
      box-shadow: 0 6px 30px rgba(0,0,0,0.45);
    }
    label {
      display: block;
      margin-top: 16px;
      font-size: 1.05rem;
    }
    input, select {
      width: 100%;
      padding: 10px;
      margin-top: 8px;
      border: 2px solid var(--border);
      border-radius: 10px;
      background: var(--paper);
      font-size: 1rem;
    }
    button {
      margin-top: 16px;
      padding: 12px 18px;
      font-size: 1.05rem;
      border: none;
      border-radius: 10px;
      background: var(--border);
      color: #fff;
      cursor: pointer;
    }
    button:hover {
      background: var(--accent);
    }
    #output {
      margin-top: 18px;
      padding: 12px;
      min-height: 80px;
      border: 1px solid var(--border);
      border-radius: 10px;
      background: rgba(255,255,255,0.65);
      white-space: pre-wrap;
    }
    #topCoinBalance {
      width: 100%;
      text-align: center;
      font-size: 1.25rem;
      font-weight: 700;
      margin-top: 12px;
    }
    .stock-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 12px;
    }
    .stock-table th, .stock-table td {
      border: 1px solid var(--border);
      padding: 8px;
      text-align: center;
      background: var(--paper);
    }
    .stock-table th {
      background: var(--paper-2);
    }
    .positive {
      color: var(--positive);
    }
    .negative {
      color: var(--negative);
    }
  </style>
</head>
<body>
  <div id="topCoinBalance">Coins: <span id="headerGoldBalance">100</span> ðŸª™</div>
  <div class="container">
    <h1>Olde Goldvault</h1>
    <label for="name">What be thy name?</label>
    <input id="name" type="text" placeholder="Enter thy name">
    <label for="credit">Dost thou seek a line of credit or a loan?</label>
    <select id="credit">
      <option value="" selected disabled>Select...</option>
      <option value="credit">Credit</option>
      <option value="loan">Loan</option>
    </select>
    <div id="creditLimitSection" style="display:none;">
      <label for="limit">Declare thy desired credit limit:</label>
      <input id="limit" type="number" min="0" placeholder="Desired credit limit">
    </div>
    <div id="loanAmountSection" style="display:none;">
      <label for="loan">State thy loan amount:</label>
      <input id="loan" type="number" min="0" placeholder="Loan amount">
    </div>
    <label for="score">Reveal thy credit score (300â€“850):</label>
    <input id="score" type="number" min="300" max="850" placeholder="300 - 850">
    <label for="months">How many moons to repay thy loan?</label>
    <input id="months" type="number" min="1" placeholder="Number of months">
    <div style="display:flex; gap:10px; flex-wrap:wrap;">
      <button id="submitBank" type="button">Submit Thy Request</button>
      <button id="resetBank" type="button">Reset Form</button>
    </div>
    <div id="output" aria-live="polite"></div>
    <div style="margin-top:28px;">
      <h1>Ye Olde Stock Exchange</h1>
      <table class="stock-table">
        <thead>
          <tr>
            <th>Guild</th>
            <th>Price (Gold)</th>
            <th>Change</th>
          </tr>
        </thead>
        <tbody id="stockBody"></tbody>
      </table>
    </div>
    <div style="margin-top:28px;">
      <h1>Thy Portfolio</h1>
      <div>Gold Balance: <span id="goldBalance">100</span> ðŸª™</div>
      <div style="margin-top:12px;">Total Portfolio Value: <span id="portfolioValue">100</span> ðŸª™</div>
      <table class="stock-table" style="margin-top:12px;">
        <thead>
          <tr>
            <th>Guild</th>
            <th>Shares</th>
            <th>Avg Buy Price</th>
            <th>Current Price</th>
          </tr>
        </thead>
        <tbody id="portfolioBody"></tbody>
      </table>
    </div>
    <div style="margin-top:28px;">
      <h1>Trade Thy Holdings</h1>
      <label for="selectedStock">Choose thy Guild to trade:</label>
      <select id="selectedStock"></select>
      <label for="tradeType">Will thou Buy or Sell?</label>
      <select id="tradeType">
        <option value="buy">Buy</option>
        <option value="sell">Sell</option>
      </select>
      <label for="tradeAmount">How many shares?</label>
      <input id="tradeAmount" type="number" min="1" placeholder="Number of shares">
      <button id="executeTrade" type="button">Execute Trade</button>
      <div id="tradeResult" style="margin-top:14px;"></div>
    </div>
    <div style="margin-top:28px;">
      <h1>Stock History</h1>
      <label for="historyStock">Select Guild to view history:</label>
      <select id="historyStock" onchange="renderStockHistory()"></select>
      <table class="stock-table" style="margin-top:12px;">
        <thead>
          <tr>
            <th>Update</th>
            <th>Price (Gold)</th>
          </tr>
        </thead>
        <tbody id="historyBody"></tbody>
      </table>
    </div>
  </div>
  <script>
    var gold = 100;
    var portfolio = {};
    var guildNames = [];
    guildNames[0] = "Blacksmith Bros";
    guildNames[1] = "Golden Anvil Co";
    guildNames[2] = "Merchant Marine Ltd";
    guildNames[3] = "Silverstone Trading";
    guildNames[4] = "Iron Mountain Corp";
    guildNames[5] = "Woodland Timber";
    guildNames[6] = "Coastal Fisheries";
    guildNames[7] = "Royal Bakery";
    guildNames[8] = "Moonlight Brewers";
    guildNames[9] = "Sunrise Farms";
    guildNames[10] = "Dragon Scale Armor";
    guildNames[11] = "Mystic Potions Inc";
    guildNames[12] = "Thunder Valley Mining";
    guildNames[13] = "Crystal Creek Mills";
    guildNames[14] = "Falcon Transport";
    guildNames[15] = "Emerald Gardens";
    guildNames[16] = "Phoenix Fire Works";
    guildNames[17] = "Shadow Creek Goods";
    guildNames[18] = "Starlight Textiles";
    guildNames[19] = "River Stone Quarry";
    var stocks = [];
    var stockIndex = 0;
    for (var i = 0; i < guildNames.length; i++) {
      var tempGuildName = guildNames[i];
      var tempStock = {};
      tempStock.name = tempGuildName;
      var randomPrice = Math.random() * 100;
      randomPrice = randomPrice + 10;
      tempStock.price = Math.floor(randomPrice);
      tempStock.change = 0;
      tempStock.history = [tempStock.price];
      stocks[stockIndex] = tempStock;
      stockIndex = stockIndex + 1;
    }
    function renderStocks() {
      var stockTableBody = document.getElementById('stockBody');
      stockTableBody.innerHTML = '';
      for (var i = 0; i < stocks.length; i++) {
        var newRow = document.createElement('tr');
        var nameCell = document.createElement('td');
        nameCell.textContent = stocks[i].name;
        var priceCell = document.createElement('td');
        priceCell.textContent = stocks[i].price;
        var changeCell = document.createElement('td');
        changeCell.textContent = stocks[i].change.toFixed(2);
        if (stocks[i].change > 0) {
          changeCell.className = 'positive';
          changeCell.textContent = '+' + stocks[i].change.toFixed(2);
        } else if (stocks[i].change < 0) {
          changeCell.className = 'negative';
        }
        newRow.appendChild(nameCell);
        newRow.appendChild(priceCell);
        newRow.appendChild(changeCell);
        stockTableBody.appendChild(newRow);
      }
    }
    function updateStocks() {
      for (var i = 0; i < stocks.length; i++) {
        var priceChange = Math.random() * 10 - 5;
        stocks[i].change = priceChange;
        var newPrice = stocks[i].price + priceChange;
        if (newPrice < 1) {
          newPrice = 1;
        }
        stocks[i].price = Math.floor(newPrice);
        stocks[i].history.push(stocks[i].price);
        if (stocks[i].history.length > 5) {
          stocks[i].history.shift();
        }
      }
      renderStocks();
      renderPortfolio();
      renderStockHistory();
    }
    function calculatePortfolioValue() {
      var totalValue = gold;
      for (var guildName in portfolio) {
        var stockFound = null;
        for (var i = 0; i < stocks.length; i++) {
          if (stocks[i].name == guildName) {
            stockFound = stocks[i];
            break;
          }
        }
        if (stockFound != null && portfolio[guildName].shares > 0) {
          totalValue = totalValue + (portfolio[guildName].shares * stockFound.price);
        }
      }
      return Math.floor(totalValue);
    }
    function renderPortfolio() {
      var portfolioBody = document.getElementById('portfolioBody');
      portfolioBody.innerHTML = '';
      for (var guildName in portfolio) {
        var stockFound = null;
        for (var i = 0; i < stocks.length; i++) {
          if (stocks[i].name == guildName) {
            stockFound = stocks[i];
            break;
          }
        }
        if (stockFound != null && portfolio[guildName].shares > 0) {
          var newRow = document.createElement('tr');
          var nameCell = document.createElement('td');
          nameCell.textContent = guildName;
          var sharesCell = document.createElement('td');
          sharesCell.textContent = portfolio[guildName].shares;
          var avgPriceCell = document.createElement('td');
          avgPriceCell.textContent = portfolio[guildName].avgBuyPrice.toFixed(2);
          var currentPriceCell = document.createElement('td');
          currentPriceCell.textContent = stockFound.price;
          newRow.appendChild(nameCell);
          newRow.appendChild(sharesCell);
          newRow.appendChild(avgPriceCell);
          newRow.appendChild(currentPriceCell);
          portfolioBody.appendChild(newRow);
        }
      }
      var goldBalanceElement = document.getElementById('goldBalance');
      goldBalanceElement.textContent = Math.floor(gold);
      var headerBalanceElement = document.getElementById('headerGoldBalance');
      headerBalanceElement.textContent = Math.floor(gold);
      var portfolioValueElement = document.getElementById('portfolioValue');
      portfolioValueElement.textContent = calculatePortfolioValue();
    }
    function populateStockDropdown() {
      var stockDropdown = document.getElementById('selectedStock');
      var historyDropdown = document.getElementById('historyStock');
      stockDropdown.innerHTML = '';
      historyDropdown.innerHTML = '';
      var defaultOption = document.createElement('option');
      defaultOption.value = '';
      defaultOption.textContent = 'Select a Guild...';
      defaultOption.disabled = true;
      defaultOption.selected = true;
      stockDropdown.appendChild(defaultOption);
      var historyDefault = defaultOption.cloneNode(true);
      historyDropdown.appendChild(historyDefault);
      for (var i = 0; i < stocks.length; i++) {
        var newOption = document.createElement('option');
        newOption.value = stocks[i].name;
        newOption.textContent = stocks[i].name;
        stockDropdown.appendChild(newOption);
        historyDropdown.appendChild(newOption.cloneNode(true));
      }
    }
    function renderStockHistory() {
      var selectedStock = document.getElementById('historyStock').value;
      var historyBody = document.getElementById('historyBody');
      historyBody.innerHTML = '';
      if (!selectedStock) {
        return;
      }
      var stockFound = null;
      for (var i = 0; i < stocks.length; i++) {
        if (stocks[i].name == selectedStock) {
          stockFound = stocks[i];
          break;
        }
      }
      if (stockFound != null) {
        for (var j = stockFound.history.length - 1; j >= 0; j--) {
          var newRow = document.createElement('tr');
          var updateCell = document.createElement('td');
          updateCell.textContent = 'Update ' + (stockFound.history.length - j);
          var priceCell = document.createElement('td');
          priceCell.textContent = stockFound.history[j];
          newRow.appendChild(updateCell);
          newRow.appendChild(priceCell);
          historyBody.appendChild(newRow);
        }
      }
    }
    function executeTrade() {
      var selectedStock = document.getElementById('selectedStock').value;
      var tradeType = document.getElementById('tradeType').value;
      var tradeAmount = document.getElementById('tradeAmount').value;
      var tradeResult = document.getElementById('tradeResult');
      tradeAmount = parseInt(tradeAmount);
      if (!selectedStock) {
        tradeResult.textContent = 'Please select a Guild to trade.';
        return;
      }
      if (isNaN(tradeAmount) || tradeAmount <= 0) {
        tradeResult.textContent = 'Enter a valid number of shares.';
        return;
      }
      var stockFound = null;
      for (var i = 0; i < stocks.length; i++) {
        if (stocks[i].name == selectedStock) {
          stockFound = stocks[i];
          break;
        }
      }
      if (stockFound == null) {
        tradeResult.textContent = 'Guild not found.';
        return;
      }
      if (tradeType == 'buy') {
        var totalCost = stockFound.price * tradeAmount;
        if (totalCost > gold) {
          tradeResult.textContent = 'Not enough gold to buy ' + tradeAmount + ' shares of ' + selectedStock + '.';
          return;
        }
        gold = gold - totalCost;
        if (portfolio[selectedStock] == undefined) {
          portfolio[selectedStock] = { shares: 0, avgBuyPrice: 0 };
        }
        var currentShares = portfolio[selectedStock].shares;
        var currentAvgPrice = portfolio[selectedStock].avgBuyPrice;
        var newShares = currentShares + tradeAmount;
        var newAvgPrice = ((currentAvgPrice * currentShares) + (stockFound.price * tradeAmount)) / newShares;
        portfolio[selectedStock].shares = newShares;
        portfolio[selectedStock].avgBuyPrice = newAvgPrice;
        tradeResult.textContent = 'Bought ' + tradeAmount + ' shares of ' + selectedStock + ' for ' + totalCost + ' gold.';
      } else if (tradeType == 'sell') {
        if (portfolio[selectedStock] == undefined || portfolio[selectedStock].shares < tradeAmount) {
          tradeResult.textContent = 'Not enough shares to sell ' + tradeAmount + ' of ' + selectedStock + '.';
          return;
        }
        var totalSale = stockFound.price * tradeAmount;
        gold = gold + totalSale;
        portfolio[selectedStock].shares = portfolio[selectedStock].shares - tradeAmount;
        tradeResult.textContent = 'Sold ' + tradeAmount + ' shares of ' + selectedStock + ' for ' + totalSale + ' gold.';
        if (portfolio[selectedStock].shares == 0) {
          delete portfolio[selectedStock];
        }
      }
      renderPortfolio();
    }
    var creditDropdown = document.getElementById('credit');
    creditDropdown.onchange = function() {
      var creditSection = document.getElementById('creditLimitSection');
      var loanSection = document.getElementById('loanAmountSection');
      if (creditDropdown.value == 'credit') {
        creditSection.style.display = 'block';
        loanSection.style.display = 'none';
      } else if (creditDropdown.value == 'loan') {
        creditSection.style.display = 'none';
        loanSection.style.display = 'block';
      } else {
        creditSection.style.display = 'none';
        loanSection.style.display = 'none';
      }
    };
    var resetButton = document.getElementById('resetBank');
    resetButton.onclick = function() {
      var nameInput = document.getElementById('name');
      nameInput.value = '';
      var creditInput = document.getElementById('credit');
      creditInput.value = '';
      var limitInput = document.getElementById('limit');
      limitInput.value = '';
      var loanInput = document.getElementById('loan');
      loanInput.value = '';
      var scoreInput = document.getElementById('score');
      scoreInput.value = '';
      var monthsInput = document.getElementById('months');
      monthsInput.value = '';
      var creditSection = document.getElementById('creditLimitSection');
      creditSection.style.display = 'none';
      var loanSection = document.getElementById('loanAmountSection');
      loanSection.style.display = 'none';
      var outputBox = document.getElementById('output');
      outputBox.textContent = '';
    };
    var submitButton = document.getElementById('submitBank');
    submitButton.onclick = function() {
      var userName = document.getElementById('name').value;
      var creditOrLoan = document.getElementById('credit').value;
      var outputBox = document.getElementById('output');
      if (!creditOrLoan) {
        outputBox.textContent = 'Pick Credit or Loan to continue.';
        return;
      }
      var message = 'Let us handle thy banking needs.\n';
      message = message + 'Fare thee well, ' + userName + '.\n';
      outputBox.textContent = message;
    };
    var tradeButton = document.getElementById('executeTrade');
    tradeButton.onclick = executeTrade;
    document.addEventListener('DOMContentLoaded', function() {
      renderStocks();
      renderPortfolio();
      populateStockDropdown();
      renderStockHistory();
      setInterval(updateStocks, 3000);
    });
  </script>
</body>
</html>
